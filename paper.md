---
title: 'mescal: coupling energy system models with life-cycle assessment' 
tags:
  - Python
  - energy system models
  - life-cycle assessment

authors:
  - name: Matthieu Souttre
    orcid: 0000-0002-6288-058X
    affiliation: 1
  - name: Guillaume Majeau-Bettez
    orcid: 0000-0002-0151-2468
    affiliation: 1
  - name: François Maréchal
    orcid: 0000-0003-1752-5690
    affiliation: "1, 2"
  - name: Manuele Margni
    orcid: 0000-0002-2475-0768
    affiliation: "1, 3"

affiliations:
  - name: CIRAIG, École Polytechnique de Montreal, 3333 Queen Mary Road, Montréal, H3V1A2, Québec, Canada
    index: 1
  - name: Industrial Process and Energy Systems Engineering group, École Polytechnique Fédérale de Lausanne, Rue de l’Industrie 17, Sion, 1950, Switzerland
    index: 2
  - name: CIRAIG, Institute for Sustainable Energy, University of Applied Sciences Western Switzerland, Rue de l’Industrie 23, Sion, 1950, Switzerland
    index: 3

date: 13 January 2025
bibliography: paper.bib
---

# Summary
Energy System Models (ESM) are widely used to design and assess energy transition scenarios. They help decision-makers 
to project their policies and understand their impact on strongly interconnected energy systems. However, ESM typically
lack environmental indicators, which are essential to assess the sustainability of energy transition scenarios.
`mescal` is a Python package that integrates Life-Cycle Assessment (LCA) indicators within ESM. It allows energy modellers
to include a wider set of environmental indicators within their models in a transparent and reproducible way.
As a result, energy modellers and decision-makers can identify transition scenarios trade-offs and hot spots, thus
enabling a more holistic sustainability assessment.

# Statement of need
ESM aim to support decision-makers to design and assess energy transition scenarios. In this work, we focus on 
bottom-up models, which describe energy technologies with a high level of technical details [@herbst2012].
Most ESM integrate carbon emissions in their modelling framework to propose and assess climate change mitigation scenarios.
However, the environmental assessment of energy transition scenarios should not be limited to carbon emissions [@hellweg2023].
For instance, the United Nations highlighted three major environmental challenges that humanity is currently facing: climate change, 
biodiversity loss, and air pollution [@unfccc2022]. Sustainability assessment methods are needed to integrate a broader 
set of environmental impact categories, including as water use, land use, human toxicity, mineral resource use, etc.
It is essential to enlarge the environmental assessment of energy transition scenarios while keeping 
comparable, robust and transparent methods [@hellweg2023].

LCA is a methodology that assesses the environmental impacts of products and services throughout their life-cycle. 
It aims to be a comprehensive environmental assessment as it considers complete value chains and a wide set of 
environmental impact categories.

ESM can be coupled to LCA with varying integration levels. Ex-post analyses are the most common approach, where 
energy transition scenarios generated by ESM are assessed with LCA as a post-processing step 
[@fernandezastudillo2019; @blanco2020; @junne2020]. Soft-linking approaches further use LCA results to adjust 
ESM projections, thus leading to iterative feedback loops between the ESM and the LCA model. 
For instance, @xu2020 computed environmental impacts of the energy mix obtained from an ESM, and then adjusted energy 
transition pathways when policy targets were violated. 
For LCA indicators to be used actively in ESM, and thus in transition scenarios design, hard-linked 
coupling is required. This denotes the endogenous integration of LCA indicators in ESM.
Several studies have endogenously integrated LCA indicators in ESM [@rauner2017; @vandepaer2020; @algunaibet2019; @reinert2022], thus 
paving the way for multi-objective optimization. @vandepaer2020 compared the use of the $\epsilon$-constraint 
method and the normalization and weighting method to integrate LCA indicators in a bottom-up optimization model. 
Alternatively, @algunaibet2019 monetized environmental impacts in order to sum them with direct and indirect costs 
within an economic objective function.

However, these studies lack generalization and are hardly reproducible when considering different ESM.

Recently, @sacchi2024 presented `pathways`, a Python package based on the `brightway` framework [@mutel2017] that 
assesses energy transition scenarios with LCA. Given an energy transition scenario generated by an ESM or Integrated Assessment 
Model (IAM), prospective LCI databases (which are typically generated using `premise` [@sacchi2022], a Python package that 
generates prospective versions of _ecoinvent_ using IAM projections) and a mapping 
between ESM/IAM scenario variables and LCI datasets, `pathways` computes the environmental impacts of transition 
scenarios and provides insights about their trade-offs and hot spots. `pathways` allows a transparent and reproducible 
assessment of energy transition scenarios. ESM/IAM results can be further included in a prospective LCI database using `premise`
custom scenarios [@sacchi2022], thus making soft-linked coupling possible.
However, such framework does not allow the endogenous integration of LCA indicators within ESM or IAM, 
thus significantly limiting energy modellers ability to shape transition scenarios with LCA results.

`mescal` aims to address this limitation, by enhancing the reproducibility and transparency of hard-linked coupling 
between LCA and ESM, thus allowing a better comparability among energy modellers envisioning to enlarge their set of 
sustainability metrics.

# Description
`mescal` reads four mandatory CSV files:

- `Mapping.csv`: the mapping between ESM technologies/resources and LCI datasets from a LCI 
database, e.g., _ecoinvent_ [@wernet2016].

- `ESM.csv`: the input and output energy vectors of ESM technologies, e.g., a gas boiler with 90% efficiency has a natural gas 
input flow of 1.11 kWh and a heat output flow of 1 kWh.

- `Conversion factors.csv`: the set of unit conversion factors between ESM technologies/resources and their mapped LCI datasets, 
e.g., from GWh to MJ.

- `CPC.csv`: the mapping between ESM energy vectors (e.g., electricity, heat, natural gas) and Central Product 
Classification (CPC) categories [@unitednations2015].

In addition, `mescal` reads several optional CSV files, including:

- `Lifetime.csv`: the lifetime of the ESM technologies in the ESM and in the LCI database.

- `Efficiency.csv`: the list of ESM technologies and their input fuel type for which efficiency adjustment will be 
performed.

- `Ranking locations.csv`: the ranking of preferred locations available in the LCI database with respect to the ESM 
geographical context. 

`mescal` operates a set of systematic transformations (\autoref{fig:workflow}) on LCI datasets based on the `brightway` 
framework [@mutel2017] and the `wurst` Python package, which are tools to perform LCA modelling and calculation 
within a Python environment.

## Mapping between ESM technologies/resources and LCI datasets
Each technology or resource of the ESM is mapped with one or several LCI datasets (`Mapping.csv`). 
Technologies are typically mapped with two LCI datasets: 1) an operation LCI dataset, which encompasses 
the use phase of the technology's life-cycle, and 2) an infrastructure LCI dataset, which encompasses the 
construction and dismantling phases of the technology's life-cycle. 
The ESM resources are typically mapped with one operation LCI dataset, which encompass the resource extraction, 
processing, and transportation phases. Regarding LCI databases, `mescal` is suited for any version of the 
_ecoinvent_ database [@wernet2016] and any prospective LCI database generated via `premise` [@sacchi2022].

## Regionalization and spatialization of LCI datasets
To make LCI datasets more specific and relevant to the ESM geographical scope, the inventory can 
be regionalized. Inventory regionalization refers to the enhancement of the geographic representativeness of the 
inventory data, which is achieved by adjusting the type and quantity of intermediary and elementary flows 
[@patouillard2018]. `mescal` regionalizes the foreground inventory by modifying the geographical location of 
the flows of all infrastructure and operation LCI datasets according to the ranking of most suitable LCI database 
locations with respect to the ESM geographical context, `Ranking locations.csv` (\autoref{fig:flowchart_regionalization}). 
Foreground regionalization is always performed for intermediary flows, and also for elementary flows if the LCI database 
is spatialized, i.e., if a geographic location has been attributed to elementary flows [@patouillard2018]. 
The types and quantities of the flows remain unchanged. The LCI database can be spatialized and its background 
inventory can be regionalized using the `regioinvent` library [@maximeagez2025].

![Flowchart of the foreground regionalization process.\label{fig:flowchart_regionalization}](docs/pics/regionalization_flowchart.png){ width=75% }

## Double-counting removal
Double-counting refers to the multiple occurrence of energy flows within the energy system supply chain, thus leading 
to an overestimation of environmental impacts. For instance, if a coal power plants produces electricity that is 
later used in a heat pump, impacts of the electricity flow are counted twice: once in the coal power plant LCI dataset
and once in the heat pump LCI dataset. @volkart2018 proposed a solution to the double-counting issue by 
setting to zero all flows in the foreground inventory that were also modelled in the ESM. 
This approach is implemented in `mescal` by identifying the flows to be nullified using their CPC 
categories [@unitednations2015] (\autoref{fig:flowchart_double_counting}). In the previous example, the input electricity
flow of the heat pump operation LCI dataset would be set to zero.

![Flowchart of the double-counting removal process. The attribution of CPC categories to activities that do not have 
one is based on their reference product.\label{fig:flowchart_double_counting}](docs/pics/double_counting_flowchart.png)

In the case of market-type LCI datasets, the flows to be nullified are contained in the background inventory. 
`mescal` determines the set of LCI datasets on which the double-counting removal process should be applied via a 
recursive algorithm exploring the market-type datasets backgrounds (\autoref{fig:flowchart_background_search}).

![Flowchart of the background search process. $k_{max}$ is the maximum authorized tree depth. $N_{int. flow}(act)$ is the 
number of intermediary flows on the activity $act$.\label{fig:flowchart_background_search}](docs/pics/background_search_flowchart.png)

## ESM and LCI database harmonization
`mescal` adjusts LCI datasets and impact scores to account for differences between the ESM and LCI database:

- **Technologies lifetime**: Infrastructure LCA indicators are annual impacts, thus `mescal` adjusts the 
infrastructure impact scores to integrate the difference of lifetime between ESM technologies and their 
infrastructure LCI datasets. The infrastructure specific impact score ($lcia_{infra}$) is multiplied by the ratio 
between the ESM lifetime ($n_{ESM}$) and the LCI dataset lifetime ($n_{LCI}$) (`Lifetime.csv`) to ensure that the annual impact in the 
ESM is computed with the LCI dataset lifetime, thus resulting in the adjusted infrastructure specific impact score 
($lcia_{infra}^{adj}$ in \autoref{eq:lcia_infra_adj}).

$$
lcia_{infra}^{adj}(j,k) & = lcia_{infra}(j,k) \cdot \frac{n_{ESM}(j)}{n_{LCI}(j)} \quad \forall (j,k) \in TECH \times ENV\label{eq:lcia_infra_adj}
$$

- **Technologies efficiency**: Efficiencies of technologies in the ESM and LCI database should be harmonized, 
even if input fuel flows are set to zero in the operation LCI dataset to prevent double-counting, because a difference in 
efficiency between a technology and its corresponding operation LCI dataset would result in an inconsistency regarding 
the amount of direct emissions. `mescal` resolves this issue by adjusting the amount of direct emissions proportionally 
to the efficiency difference. Except land occupation, land transformation and energy elementary flows, the amounts ($q$) 
of all elementary flows in the operation LCI datasets foregrounds are adjusted using the ratio between 
the LCI dataset ($\eta_{LCI}$) and the ESM ($\eta_{ESM}$) efficiencies, thus resulting in adjusted direct emissions 
amounts ($q^{adj}$ in \autoref{eq:q_adj}). 
The efficiency of the operation LCI dataset ($\eta_{LCI}$) is computed using the quantity of fuel that was removed during the 
double-counting removal step, while the efficiency of the ESM process ($\eta_{ESM}$) is computed from `ESM.csv`. This transformation 
is applied to a list of relevant ESM technologies (`Efficiency.csv`), e.g., technologies involving a combustion process.

$$
q^{adj}(ef, j) & = q(ef, j) \cdot \frac{\eta_{LCI}(j)}{\eta_{ESM}(j)} \quad \forall (ef, j) \in EF \setminus \{\text{land, energy}\} \times TECH\label{eq:q_adj}
$$

- **Physical units**: The product flows may be expressed in different units in the ESM and the LCI 
database. Specific impact scores are multiplied by a conversion factor, which converts the specific LCA 
scores physical unit from [impact category unit / LCI output unit] to [impact category unit / ESM output unit]. 
Conversion factors encompass LCI datasets assumptions such as capacity factors or vehicle load factors (`Conversion factors.csv`).

- **Generation of new LCI datasets**: `mescal` generates new LCI datasets by operating modifications on existing ones, 
to enhance their alignment with the corresponding ESM technology. For example, biodiesel-fuelled mobility LCI datasets
are created by replacing direct fossil carbon emissions by biogenic carbon emissions, while the fossil diesel input is 
set to zero during the double-counting removal step. 

## Life-Cycle Impact Assessment
`mescal` can compute LCA indicators using any set of impact assessment methods, e.g., IMPACT World+ [@bulle2019], ReCiPe 
[@huijbregts2017] or Environmental Footprint (EF) [@europeancommission.jointresearchcentre.2018]. 
Alternatively, a module computing only direct emissions has been developed to ease the comparison between territorial 
emissions and life-cycle emissions. 

## Normalization of LCA indicators 
Prior to integration into ESM, LCA indicators are normalized. In the context of optimization, 
normalization is beneficial in facilitating the solver's convergence, given that LCA indicators may exhibit 
significant discrepancies in magnitude across impact categories. By aligning all metrics within a comparable order of 
magnitude, numerical stability is improved in the solving process. 
Furthermore, considerable discrepancies in magnitude may be observed between infrastructure and operation LCA indicators 
within the same impact category, as these are not expressed with the same physical unit. 
Consequently, a scaling factor ($lcia_{op,max}(k) / lcia_{infra,max}(k)$ in \autoref{eq:lcia_infra_scaled}) is applied 
to infrastructure LCA indicators, to ensure that both the highest infrastructure and operation indicators are normalized to 1. 
The scaling factor invert is then applied to normalized infrastructure indicators (autoref{eq:lcia_type_norm}), 
in order to keep the magnitude difference between operation and infrastructure LCA indicators in ESM. 
Normalization is performed with the maximum indicator ($lcia_{max}$ in \autoref{eq:lcia_max}) of each impact category. 
In addition, all normalized indicators ($lcia_{type}^{norm}$ in autoref{eq:lcia_type_norm}) that are below a threshold 
($\epsilon$) are set to zero. This aims to determine the maximum order of magnitude between the highest and lowest 
indicators of an impact category, to eventually facilitate the solver convergence.

$$
\begin{split}\label{eq:lcia_type_max}
lcia_{type,max}(k) & = \max(lcia_{type}(j,k) \ | \ j \in TECH \ \cup \ RES) \\
& \forall type \in \{infra, op\} \quad \forall k \in ENV
\end{split}
$$

$$
lcia_{infra}^{scaled}(j,k) & = lcia_{infra}^{adj}(j,k) \cdot \dfrac{lcia_{op,max}(k)}{lcia_{infra,max}(k)} \forall (j,k) \in TECH \times ENV\label{eq:lcia_infra_scaled}
$$

$$
lcia_{max}(k) & = \max(lcia_{type,max}(j,k) \ | \ type \in \{infra, op\}, \ j \in TECH) \quad \forall k \in ENV\label{eq:lcia_max}
$$

$$
lcia_{type}^{norm}(j,k) = 
\begin{cases}
    0 \text{ if } \dfrac{lcia_{type}^{(scaled)}(j,k)}{lcia_{max}(k)} \leq \epsilon \\
    \dfrac{lcia_{type}^{(scaled)}(j,k)}{lcia_{max}(k)} \cdot \dfrac{lcia_{infra,max}(k)}{lcia_{op,max}(k)} \text{ elif } type = infra\label{eq:lcia_type_norm} \\
    \dfrac{lcia_{type}^{(scaled)}(j,k)}{lcia_{max}(k)} \text{ else}
\end{cases}
$$
$$
\forall (j,k) \in TECH \ \cup \ RES \times ENV \quad \forall type \in \{infra, op\}
$$

## Equations specification
The following set of modelling equations is included in ESM.
The environmental objective ${LCIA_{tot}}$ is defined as the sum of the impacts of the infrastructure, operation, 
and resource parts (\autoref{eq:lcia_tot}).
The infrastructure impact is derived from the normalized specific impact ($lcia^{norm}_{infra}$), which is computed 
from the infrastructure LCI dataset. The normalized specific impact is divided by the technology's lifetime in the ESM 
($n_{ESM}$), and scaled with the technology's installed capacity (${F}$) (\autoref{eq:lcia_infra}). 
The operation and resource impacts are respectively derived from the operation and resource normalized specific 
impacts ($lcia^{norm}_{op}$), which are respectively computed from the operation and resource LCI datasets, and scaled 
with the annual operation (${F_t} \times t_{op}$) (\autoref{eq:lcia_op}). 

$$
\begin{split}
{LCIA_{tot}}(k) & = \sum_{j \in TECH} \left( {LCIA_{infra}}(j, k) + {LCIA_{op}}(j, k) \right) + \sum_{r \in RES} {LCIA_{op}}(r, k)\label{eq:lcia_tot} \\ 
& \forall k \in ENV
\end{split}
$$

$$
{LCIA_{infra}}(j, k) & = lcia_{infra}^{norm}(j, k) \cdot {F}(j) \cdot \frac{1}{n_{ESM}(j)} \quad \forall (j, k) \in TECH \times ENV\label{eq:lcia_infra}
$$

$$
{LCIA_{op}}(j, k) & = lcia_{op}^{norm}(j, k) \cdot \sum_{t \in T} {F_t}(j, t) \cdot t_{op}(t) \quad \forall (j, k) \in TECH \cup RES \times ENV\label{eq:lcia_op}
$$

## Integrating ESM results in the LCI database
In ordre to update the LCI database with the ESM results, `mescal` overwrites the relevant LCI datasets, 
i.e., LCI datasets that are in the sectoral and geographical scope of the ESM, such as markets for electricity, heat or 
transport. The activities composing the market and their respective shares are determined using the ESM annual 
operation results and the `Mapping.csv` file .  
Updating the LCI database background inventory paves for the way for using `mescal` with myopic ESM, i.e., ESM 
dividing the transition period into a sequence of consecutive optimization problems [@prina2020], through an iterative 
3-step procedure: 1) run the ESM at time-step $t$, 2) update the LCI database with the ESM results at time-step $t$, 
and 3) update the LCA indicators with the updated LCI database for time-step $t+1$.

![`mescal` workflow.\label{fig:workflow}](docs/pics/workflow_v2.png)

An [example notebook](https://github.com/matthieu-str/mescal/blob/master/examples/tutorial.ipynb) is available to illustrate the use of `mescal`.

# Impact
`mescal` offers a systematic methodology to hard-link ESM with LCA, thus enabling the integration of environmental
constraints and objectives in ESM, and thus a flexible design and environmental assessment of energy transition scenarios. 
The use of `mescal` ensures a transparent, reproducible, and thus comparable integration of LCA indicators in ESM.
The use of LCA makes sustainability assessments of energy modellers more holistic, thus highlighting the potential trade-offs, 
benefits, and adverse side effects of energy transition pathways among the environmental and economic performance indicators.
`mescal` is aimed to be used by energy modellers who might not be LCA experts but want to enlarge the set of environmental 
indicators in their model in a transparent and reproducible way.

As an example, `mescal` methodology has been applied by @schnidrig2024 with the _EnergyScope_ model [@moret2017] 
to analyse environmental-economic trade-offs in Swiss energy system transitions.

# Conclusion
`mescal` makes the integration of LCA indicators in ESM more transparent, reproducible, and comparable. 
It aims to encourage energy modellers to consider a broader set of environmental indicators in their energy transition
scenarios, thus enabling a more holistic sustainability assessment. 

# Acknowledgements
The authors gratefully acknowledge the financial support of the _Fonds de recherche du Québec - Nature et 
Technologies_, the _Institut de l’énergie Trottier de Polytechnique Montréal_ and the _CREATE-SEED_ program.

# Nomenclature 

## Sets 
| Symbol | Description                            |
|--------|----------------------------------------|
| $TECH$ | Set of ESM technologies                |
| $RES$  | Set of ESM resources                   |
| $T$    | Set of time periods                    |
| $ENV$  | Set of environmental impact categories |

## Parameters
| Symbol              | Description                                                                         | Unit                                  |
|---------------------|-------------------------------------------------------------------------------------|---------------------------------------|
| $t_{op}(t)$         | Time period $t$ duration                                                            | hours                                 |
| $n_{ESM}(j)$        | Lifetime of a technology $j$ in the ESM                                             | years                                 |
| $n_{LCI}$           | Lifetime of a technology $j$ in the LCI dataset                                     | years                                 |
| $lcia_{infra}(j,k)$ | Specific infrastructure impact of technology $j$ for impact category $k$            | impact category unit / capacity unit  |
| $lcia_{op}(j/r,k)$  | Specific operation impact of technology $j$ or resource $r$ for impact category $k$ | impact category unit / operation unit |
| $\eta_{LCI}(j)$     | Efficiency of technology $j$ in the operation LCI dataset                           | dimensionless                         |
| $\eta_{ESM}(j)$     | Efficiency of technology $j$ in the ESM                                             | dimensionless                         |
| $q(ef, j)$          | Amount of elementary flow $ef$ in the operation LCI dataset of technology $j$       | elementary flow unit                  |
| $\epsilon$          | Threshold for the normalization of LCA indicators                                   | dimensionless                         |

## Variables
| Symbol              | Description                                                                           | Unit           |
|---------------------|---------------------------------------------------------------------------------------|----------------|
| $F(j)$              | Installed capacity of technology $j$                                                  | capacity unit  |
| $F_t(j,t)$          | Operation of technology $j$ in time period $t$                                        | operation unit |
| $LCIA_{tot}(k)$     | Normalized total impact of impact category $k$                                        | dimensionless  |
| $LCIA_{infra}(j,k)$ | Normalized infrastructure impact of technology $j$ for impact category $k$            | dimensionless  |
| $LCIA_{op}(j/r,k)$  | Normalized operation impact of technology $j$ or resource $r$ for impact category $k$ | dimensionless  |

# References